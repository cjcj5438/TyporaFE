# 定义

### 回流(reflow) 

当浏览器发现某个部分发现变化影响了布局时，需要倒回去重新渲染，会从html标签开始递归往下，重新计算位置和大小。
reflow基本是无法避免的，因为当你滑动一下鼠标、resize 窗口，页面就会产生变化。

### 重绘(repaint)

改变了某个元素的背景色、文字颜色等等不会影响周围元素的位置变化时，就会发生重绘。
每次重绘后，浏览器还需要合并渲染层并输出到屏幕上。
回流的成本要比重绘高很多，所以我们应该尽量避免产生回流。



# 如何减少重绘与回流

### CSS

1. 使用 transform 替代 top1
2. 使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）
3. 避免使用table布局，可能很小的一个小改动会造成整个 table 的重新布局。
4. 尽可能在DOM树的最末端改变class，回流是不可避免的，但可以减少其影响。<u>尽可能在DOM树的最末端改变class</u>，可以限制了回流的范围，使其影响尽可能少的节点。
5. <u>避免设置多层内联样式</u>，CSS 选择符从右往左匹配查找，避免节点层级过多。
6. <u>将动画效果应用到position属性为absolute或fixed的元素</u>上，避免影响其他元素的布局，这样只是一个重绘，而不是回流，同时，控制动画速度可以选择 requestAnimationFrame，详见探讨 requestAnimationFrame。
7. 避免使用CSS表达式，可能会引发回流。
8. <u>将频繁重绘或者回流的节点设置为图层</u>，图层能够阻止该节点的渲染行为影响别的节点，例如will-change、video、iframe等标签，浏览器会自动将该节点变为图层。
9. <u>CSS3 硬件加速（GPU加速</u>），使用css3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘 。但是对于动画的其它属性，比如background-color这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。

### JavaScript。

1. <u>避免频繁操作样式</u>，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。
2. <u>避免频繁操作DOM</u>，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。
3. <u>避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来</u>。
4. 对具<u>有复杂动画的元素使用绝对定位</u>，使它脱离文档流，否则会引起父元素及后续元素频繁回流。