# 基本流程 

https://zhuanlan.zhihu.com/p/80551769    笔记来源

<img src="https://raw.githubusercontent.com/cjcj5438/picGo/master/v2-d2ea43fca9c994d20b2d83b94358111e_1440w-20220311141754615.jpg?token=AFPYJOYFEDRP3UWHENKMRFLCFLU46" alt="img" style="zoom:67%;" />

# html解析

**1. 解码（encoding）**

将二进制字节数据转换成HTML 代码

**2. 预解析（pre-parsing）**

预解析做的事情是提前加载资源，如img、src

**3. 符号化（Tokenization）**

词法分析 HTML 符号包括，开始标签、结束标签、属性名和属性值等

**4. 构建树（tree construction）**

形成DOM节点



# css解析

1. **下载好的 CSS 并进行标记化**

2. **CSS 匹配规则**从右到左的顺序的依次匹配



# 渲染树

其实这就是一个 DOM 树和 CSS 规则树合并的过程



# 布局与绘制

确定渲染树种所有节点的几何属性，比如：位置、大小等等，最后输入一个盒子模型，它能精准地捕获到每个元素在屏幕内的准确位置与大小。然后遍历渲染树，调用渲染器的 paint() 方法在屏幕上显示其内容。



# 合并渲染层

把以上绘制的所有图片合并，最终输出一张图片

# 回流与重绘

- 回流：当浏览器发现某个部分发现变化**影响了布局时，需要倒回去重新渲染**，会从`html`标签开始递归往下，重新计算位置和大小。

- 重绘：改变了某个元素的背景色、文字颜色等等**不会影响周围元素的位置变化**时，就会发生重绘。

  

# JavaScript编译执行

大致流程图：

<img src="https://raw.githubusercontent.com/cjcj5438/picGo/master/v2-6ce3a70730963ec458189e78c5a2f217_1440w-20220311141820537.jpg?token=AFPYJO25GNH6KP3KK7W5FMDCFLU6S" alt="img" style="zoom:50%;" />

### 语法分析

- 分词，例如将`var a = 2`，分成`var`、`a`、`=`、`2`这样的词法单元。
- 解析，将词法单元转换成抽象语法树（AST）。
- 代码生成，将抽象语法树转换成机器指令。

### 预编译

定义：每进入一个不同的运行环境都会创建一个对应的执行上下文，根据不同的上下文环境，形成一个函数调用栈，栈底永远是全局执行上下文，栈顶则永远是当前执行上下文。【全局环境、函数环境~~、eval~~】

#### 创建执行上下文(三件事)

1. 创建变量对象》参数、函数、变量
2. 建立作用域链〉确认当前执行环境是否能访问变量
3. 确定 This 指向

### 执行

**JS 线程** ：单线程的

![img](https://raw.githubusercontent.com/cjcj5438/picGo/master/v2-1cf9f632051663cc8c8415c29dadbcc0_1440w-20220311141844068.jpg?token=AFPYJO5WJB5AQZSJ7MRODR3CFLVAA)

*JS 引擎线程：也叫 JS 内核，负责解析执行 JS 脚本程序的主线程，例如 <u>V8 引擎</u>*

**注：浏览器对同一域名的并发连接数是有限的，通常为 6 个。**

**宏任务** 见其他

**微任务** 见其他